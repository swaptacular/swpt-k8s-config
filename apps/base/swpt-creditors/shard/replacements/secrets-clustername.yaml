source:
  group: acid.zalan.do
  version: v1
  kind: postgresql
  name: db
  fieldPath: metadata.name
targets:
  - select:
      group: acid.zalan.do
      version: v1
      kind: postgresql
      name: db
    fieldPaths:
      - spec.sidecars.[name=exporter].env.[name=DATA_SOURCE_USER].valueFrom.secretKeyRef.name
      - spec.sidecars.[name=exporter].env.[name=DATA_SOURCE_PASS].valueFrom.secretKeyRef.name
      - spec.sidecars.[name=backup-exporter].env.[name=PGUSER].valueFrom.secretKeyRef.name
      - spec.sidecars.[name=backup-exporter].env.[name=PGPASSWORD].valueFrom.secretKeyRef.name
    options:
      delimiter: "."
      index: 1
  - select:
      name: postgres.cluster-name.credentials.postgresql.acid.zalan.do
      kind: Secret
    fieldPaths:
      - metadata.labels.cluster-name
  - select:
      name: postgres.cluster-name.credentials.postgresql.acid.zalan.do
      kind: Secret
    fieldPaths:
      - metadata.name
    options:
      delimiter: "."
      index: 1
  - select:
      name: standby.cluster-name.credentials.postgresql.acid.zalan.do
      kind: Secret
    fieldPaths:
      - metadata.labels.cluster-name
  - select:
      name: standby.cluster-name.credentials.postgresql.acid.zalan.do
      kind: Secret
    fieldPaths:
      - metadata.name
    options:
      delimiter: "."
      index: 1
  - select:
      name: db-owner.cluster-name.credentials.postgresql.acid.zalan.do
      kind: Secret
    fieldPaths:
      - metadata.labels.cluster-name
  - select:
      name: db-owner.cluster-name.credentials.postgresql.acid.zalan.do
      kind: Secret
    fieldPaths:
      - metadata.name
    options:
      delimiter: "."
      index: 1
